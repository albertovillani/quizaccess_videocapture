{"version":3,"file":"face_recognition.min.js","sources":["../src/face_recognition.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the face recognition process.\n *\n * @module     quizaccess_videocapture/face_recognition\n * @author     Alberto Villani <alberto.villani@abacotechnology.it>\n * @copyright  2022 Abaco Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport ModalCancel from 'core/modal_cancel';\nimport RC from 'quizaccess_videocapture/face_recognition_client';\nimport Templates from 'core/templates';\nimport {getString} from 'core/str';\n\nexport const init = () => {\n\n    $('input[name=\"cancel\"]').on('click', () => {\n        $('#recogfailed').hide();\n        $('#recogsuccess').hide();\n        $('#recogloader').hide();\n        $('.videocappreflight').hide();\n        $('input[name=\"submitbutton\"]').attr('disabled', 'disabled');\n        RC.releaseStream();\n    });\n\n    $('button[name=\"startvideocap\"]').on('click', function(){\n        $('#recogfailed').hide();\n        $('.pic_container').show();\n        $('#failedmessage').show();\n        $('#failedmessage_api').hide();\n        $('#recogsuccess').hide();\n        $('#recogloader').hide();\n        $('.videocappreflight').show();\n        if(RC.stream === null){\n            RC.startVideoCap('video', 'canvas', 'photo');\n        }else{\n            $('#recogloader').show();\n            RC.takepicture();\n        }\n    });\n\n    $('#abacoprivacylink').on('click', function (e){\n        e.preventDefault();\n        privacyModalFunction();\n    });\n\n    document.addEventListener('snapshotCheckFailed', (e) =>{\n        $('input[name=\"facematched\"]').attr('value', '0');\n        $('input[name=\"submitbutton\"]').attr('disabled', 'disabled');\n        $('#recogsuccess').hide();\n        $('#recogloader').hide();\n        $('#recogfailed').show();\n        if(e.detail.remote_error){\n            $('.pic_container').hide();\n            $('#failedmessage').hide();\n            $('#failedmessage_api').show();\n        }\n    });\n\n    document.addEventListener('snapshotCheckSuccess', () =>{\n        $('input[name=\"facematched\"]').attr('value', '1');\n        $('input[name=\"submitbutton\"]').removeAttr('disabled');\n        $('#recogfailed').hide();\n        $('#recogloader').hide();\n        $('#recogsuccess').show();\n    });\n\n    document.getElementById('video').addEventListener('canplay', () => {\n        $('#recogloader').show();\n    });\n};\n\nconst privacyModalFunction = async() => {\n    const privacyModal = await ModalCancel.create({\n        title: getString('abacoprivacytitle','quizaccess_videocapture'),\n        body: Templates.render('quizaccess_videocapture/modal_privacy_body'),\n    });\n    privacyModal.show();\n};\n"],"names":["on","hide","attr","releaseStream","show","RC","stream","startVideoCap","takepicture","e","preventDefault","privacyModalFunction","document","addEventListener","detail","remote_error","removeAttr","getElementById","async","ModalCancel","create","title","body","Templates","render"],"mappings":";;;;;;;;oTA8BoB,yBAEd,wBAAwBA,GAAG,SAAS,yBAChC,gBAAgBC,2BAChB,iBAAiBA,2BACjB,gBAAgBA,2BAChB,sBAAsBA,2BACtB,8BAA8BC,KAAK,WAAY,6CAC9CC,uCAGL,gCAAgCH,GAAG,SAAS,+BACxC,gBAAgBC,2BAChB,kBAAkBG,2BAClB,kBAAkBA,2BAClB,sBAAsBH,2BACtB,iBAAiBA,2BACjB,gBAAgBA,2BAChB,sBAAsBG,OACP,OAAdC,iCAAGC,wCACCC,cAAc,QAAS,SAAU,8BAElC,gBAAgBH,wCACfI,sCAIT,qBAAqBR,GAAG,SAAS,SAAUS,GACzCA,EAAEC,iBACFC,0BAGJC,SAASC,iBAAiB,uBAAwBJ,wBAC5C,6BAA6BP,KAAK,QAAS,yBAC3C,8BAA8BA,KAAK,WAAY,gCAC/C,iBAAiBD,2BACjB,gBAAgBA,2BAChB,gBAAgBG,OACfK,EAAEK,OAAOC,mCACN,kBAAkBd,2BAClB,kBAAkBA,2BAClB,sBAAsBG,WAIhCQ,SAASC,iBAAiB,wBAAwB,yBAC5C,6BAA6BX,KAAK,QAAS,yBAC3C,8BAA8Bc,WAAW,gCACzC,gBAAgBf,2BAChB,gBAAgBA,2BAChB,iBAAiBG,UAGvBQ,SAASK,eAAe,SAASJ,iBAAiB,WAAW,yBACvD,gBAAgBT,iBAIpBO,qBAAuBO,iBACEC,sBAAYC,OAAO,CAC1CC,OAAO,kBAAU,oBAAoB,2BACrCC,KAAMC,mBAAUC,OAAO,iDAEdpB"}