define("quizaccess_videocapture/face_recognition_block",["exports","jquery","core/templates","quizaccess_videocapture/modal_facecheck","quizaccess_videocapture/face_recognition_client"],(function(_exports,_jquery,_templates,_modal_facecheck,_face_recognition_client){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Manage the face recognition process in the quiz attempt block.
   *
   * @module     quizaccess_videocapture/face_recognition_block
   * @author     Alberto Villani <alberto.villani@abacotechnology.it>
   * @copyright  2022 Abaco Technology
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_modal_facecheck=_interopRequireDefault(_modal_facecheck),_face_recognition_client=_interopRequireDefault(_face_recognition_client);var user_context=null,course=null,check_interval=null,max_failed_checks=null,moodleurl=null;_exports.init=(user_context_id,course_id,interval,maxfailedchecks,moodle_url)=>{user_context=user_context_id,course=course_id,check_interval=interval,max_failed_checks=maxfailedchecks,moodleurl=moodle_url,_face_recognition_client.default.setFlow("attempt"),_face_recognition_client.default.setPhotoTarget("photo_target"),_face_recognition_client.default.startVideoCap("video","canvas","photo"),document.addEventListener("snapshotCheckSuccess",(()=>{window.setTimeout(_face_recognition_client.default.takepicture,check_interval)})),document.addEventListener("snapshotCheckFailed",(e=>{modalFunction(e.detail.failed_attempt,e.detail.remote_error)}))};const modalFunction=async(fa,remote_error)=>{let lock=fa>=max_failed_checks,body="";body=remote_error?"quizaccess_videocapture/modal_facecheck_body_api_error":"quizaccess_videocapture/modal_facecheck_body";const modal=await _modal_facecheck.default.create({body:_templates.default.render(body,{captured_pic:(0,_jquery.default)("#photo").attr("src"),user_context:user_context,lock:lock,nocachecode:Date.now(),moodleurl:moodleurl})});modal.setRecClient(_face_recognition_client.default),modal.setExitLink(moodleurl+"course/view.php?id="+course),fa>=max_failed_checks&&modal.hideTryAgain(),modal.show()}}));

//# sourceMappingURL=face_recognition_block.min.js.map