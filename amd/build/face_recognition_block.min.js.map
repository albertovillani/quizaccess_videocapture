{"version":3,"file":"face_recognition_block.min.js","sources":["../src/face_recognition_block.js"],"sourcesContent":["\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport ModalFaceCheck from 'quizaccess_videocapture/modal_facecheck';\nimport RC from 'quizaccess_videocapture/face_recognition_client';\n\nvar user_context = null;\nvar course = null;\nvar check_interval = null;\nvar max_failed_checks = null;\n\nexport const init = (user_context_id, course_id, interval, maxfailedchecks) => {\n\n    user_context = user_context_id;\n    course = course_id;\n    check_interval = interval;\n    max_failed_checks = maxfailedchecks;\n\n    RC.setFlow('attempt');\n    RC.setPhotoTarget('photo_target');\n    RC.startVideoCap('video', 'canvas', 'photo');\n\n\n    document.addEventListener('snapshotCheckSuccess', () =>{\n         window.setTimeout(RC.takepicture, check_interval);\n    });\n\n    document.addEventListener('snapshotCheckFailed', (e) =>{\n        modalFunction(e.detail.failed_attempt, e.detail.remote_error);\n    });\n};\n\nconst modalFunction = async(fa, remote_error) => {\n    let lock = (fa >= max_failed_checks)?true:false;\n    let body = '';\n    if(remote_error){\n        body = 'quizaccess_videocapture/modal_facecheck_body_api_error';\n    }else{\n        body = 'quizaccess_videocapture/modal_facecheck_body';\n    }\n    const modal = await ModalFaceCheck.create({\n                    body: Templates.render(body,\n                          {captured_pic: $('#photo').attr('src'), user_context: user_context, lock: lock, nocachecode: Date.now()}\n                  )\n    });\n    modal.setRecClient(RC);\n    modal.setExitLink('/course/view.php?id='+course);\n    if(fa >= max_failed_checks){\n        modal.hideTryAgain();\n    }\n    modal.show();\n};"],"names":["user_context","course","check_interval","max_failed_checks","user_context_id","course_id","interval","maxfailedchecks","setFlow","setPhotoTarget","startVideoCap","document","addEventListener","window","setTimeout","RC","takepicture","e","modalFunction","detail","failed_attempt","remote_error","async","fa","lock","body","modal","ModalFaceCheck","create","Templates","render","captured_pic","attr","nocachecode","Date","now","setRecClient","setExitLink","hideTryAgain","show"],"mappings":"woBAMIA,aAAe,KACfC,OAAS,KACTC,eAAiB,KACjBC,kBAAoB,mBAEJ,CAACC,gBAAiBC,UAAWC,SAAUC,mBAEvDP,aAAeI,gBACfH,OAASI,UACTH,eAAiBI,SACjBH,kBAAoBI,iDAEjBC,QAAQ,4CACRC,eAAe,iDACfC,cAAc,QAAS,SAAU,SAGpCC,SAASC,iBAAiB,wBAAwB,KAC7CC,OAAOC,WAAWC,iCAAGC,YAAad,mBAGvCS,SAASC,iBAAiB,uBAAwBK,IAC9CC,cAAcD,EAAEE,OAAOC,eAAgBH,EAAEE,OAAOE,wBAIlDH,cAAgBI,MAAMC,GAAIF,oBACxBG,KAAQD,IAAMpB,kBACdsB,KAAO,GAEPA,KADDJ,aACQ,yDAEA,qDAELK,YAAcC,yBAAeC,OAAO,CAC1BH,KAAMI,mBAAUC,OAAOL,KACjB,CAACM,cAAc,mBAAE,UAAUC,KAAK,OAAQhC,aAAcA,aAAcwB,KAAMA,KAAMS,YAAaC,KAAKC,UAGxHT,MAAMU,aAAarB,kCACnBW,MAAMW,YAAY,uBAAuBpC,QACtCsB,IAAMpB,mBACLuB,MAAMY,eAEVZ,MAAMa"}