{"version":3,"file":"face_recognition_block.min.js","sources":["../src/face_recognition_block.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manage the face recognition process in the quiz attempt block.\n *\n * @module     quizaccess_videocapture/face_recognition_block\n * @author     Alberto Villani <alberto.villani@abacotechnology.it>\n * @copyright  2022 Abaco Technology\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport ModalFaceCheck from 'quizaccess_videocapture/modal_facecheck';\nimport RC from 'quizaccess_videocapture/face_recognition_client';\n\nvar user_context = null;\nvar course = null;\nvar check_interval = null;\nvar max_failed_checks = null;\nvar moodleurl = null;\n\nexport const init = (user_context_id, course_id, interval, maxfailedchecks, moodle_url) => {\n\n    user_context = user_context_id;\n    course = course_id;\n    check_interval = interval;\n    max_failed_checks = maxfailedchecks;\n    moodleurl = moodle_url;\n\n    RC.setFlow('attempt');\n    RC.setPhotoTarget('photo_target');\n    RC.startVideoCap('video', 'canvas', 'photo');\n\n\n    document.addEventListener('snapshotCheckSuccess', () =>{\n         window.setTimeout(RC.takepicture, check_interval);\n    });\n\n    document.addEventListener('snapshotCheckFailed', (e) =>{\n        modalFunction(e.detail.failed_attempt, e.detail.remote_error);\n    });\n};\n\nconst modalFunction = async(fa, remote_error) => {\n    let lock = (fa >= max_failed_checks)? true : false;\n    let body = '';\n    if(remote_error){\n        body = 'quizaccess_videocapture/modal_facecheck_body_api_error';\n    }else{\n        body = 'quizaccess_videocapture/modal_facecheck_body';\n    }\n    const modal = await ModalFaceCheck.create({\n                    body: Templates.render(body,\n                          {captured_pic: $('#photo').attr('src'), user_context: user_context, lock: lock,\n                          nocachecode: Date.now(), moodleurl: moodleurl}\n                  )\n    });\n    modal.setRecClient(RC);\n    modal.setExitLink(moodleurl+'course/view.php?id='+course);\n    if(fa >= max_failed_checks){\n        modal.hideTryAgain();\n    }\n    modal.show();\n};"],"names":["user_context","course","check_interval","max_failed_checks","moodleurl","user_context_id","course_id","interval","maxfailedchecks","moodle_url","setFlow","setPhotoTarget","startVideoCap","document","addEventListener","window","setTimeout","RC","takepicture","e","modalFunction","detail","failed_attempt","remote_error","async","fa","lock","body","modal","ModalFaceCheck","create","Templates","render","captured_pic","attr","nocachecode","Date","now","setRecClient","setExitLink","hideTryAgain","show"],"mappings":";;;;;;;;gTA6BIA,aAAe,KACfC,OAAS,KACTC,eAAiB,KACjBC,kBAAoB,KACpBC,UAAY,mBAEI,CAACC,gBAAiBC,UAAWC,SAAUC,gBAAiBC,cAExET,aAAeK,gBACfJ,OAASK,UACTJ,eAAiBK,SACjBJ,kBAAoBK,gBACpBJ,UAAYK,4CAETC,QAAQ,4CACRC,eAAe,iDACfC,cAAc,QAAS,SAAU,SAGpCC,SAASC,iBAAiB,wBAAwB,KAC7CC,OAAOC,WAAWC,iCAAGC,YAAahB,mBAGvCW,SAASC,iBAAiB,uBAAwBK,IAC9CC,cAAcD,EAAEE,OAAOC,eAAgBH,EAAEE,OAAOE,wBAIlDH,cAAgBI,MAAMC,GAAIF,oBACxBG,KAAQD,IAAMtB,kBACdwB,KAAO,GAEPA,KADDJ,aACQ,yDAEA,qDAELK,YAAcC,yBAAeC,OAAO,CAC1BH,KAAMI,mBAAUC,OAAOL,KACjB,CAACM,cAAc,mBAAE,UAAUC,KAAK,OAAQlC,aAAcA,aAAc0B,KAAMA,KAC1ES,YAAaC,KAAKC,MAAOjC,UAAWA,cAG1DwB,MAAMU,aAAarB,kCACnBW,MAAMW,YAAYnC,UAAU,sBAAsBH,QAC/CwB,IAAMtB,mBACLyB,MAAMY,eAEVZ,MAAMa"}